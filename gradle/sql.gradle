/**
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership. The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
// Configuration for SQL tasks
// https://docs.groovy-lang.org/latest/html/api/groovy/sql/Sql.html
ext.dbUrl = 'jdbc:mysql:thin://localhost:3306/'
ext.dbClassName = 'org.drizzle.jdbc.DrizzleDriver'
ext.dbUsername = 'root'
ext.dbPassword = 'mysql'

task createDB {
    description = 'Creates the Database. Needs database name to be passed (like: -PdbName=someDBname)'
    doLast {
        def sql = groovy.sql.Sql.newInstance( "$dbUrl".toString(), "$dbUsername".toString(), "$dbPassword".toString(), "$dbClassName".toString() )
        sql.execute( "CREATE DATABASE $dbName" )
    }
}

task dropDB {
    description = 'Drops the specified database. The database name has to be passed (like: -PdbName=someDBname)'
    doLast {
        def sql = groovy.sql.Sql.newInstance( "$dbUrl".toString(), "$dbUsername".toString(), "$dbPassword".toString(), "$dbClassName".toString() )
        sql.execute( "DROP DATABASE $dbName" )
    }
}

task setBlankPassword {
    description = 'Reset password. The database name has to be passed (like: -PdbName=someDBname)'
    doLast {
        def sql = groovy.sql.Sql.newInstance( "$dbUrl".toString(), "$dbUsername".toString(), "$dbPassword".toString(), "$dbClassName".toString() )
        sql.execute('''\
        USE `fineract_tenants`;
        UPDATE fineract_tenants.tenants SET schema_server = 'localhost', schema_server_port = '3306', schema_username = 'mifos', schema_password = 'mysql' WHERE id=1;
        ''')
    }
}
